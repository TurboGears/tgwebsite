
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>File Upload Tutorial &mdash; TurboGears 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/tg.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/sidebar.js"></script>
    <script type="text/javascript" src="_static/header.js"></script>
    <link rel="top" title="TurboGears 1.0 documentation" href="index.html" />
    <link rel="next" title="File Upload Progress Bar" href="FileUploadProgressBar.html" />
    <link rel="prev" title="Generating Graphs and Figures in TurboGears" href="GenerateFigures.html" />

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="FileUploadProgressBar.html" title="File Upload Progress Bar"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="GenerateFigures.html" title="Generating Graphs and Figures in TurboGears"
             accesskey="P">previous</a> |</li>
<li><a href="index.html">TurboGears 1.0 documentation</a> &raquo;</li>
<li id="searchbox" style="display: none; margin: 0 20px;" class="right">
  <form class="search" action="search.html" method="get">
    <span>Search:</span>
    <input type="text" name="q" size="18" />
    <input type="submit" value="Go" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</li>
<script type="text/javascript">$('#searchbox').show(0);</script>
 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">TurboGears 1.0 FAQ</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Install/index.html">Downloading and Installing TurboGears</a></li>
<li class="toctree-l1"><a class="reference internal" href="Install/Deployment.html">Deploying TurboGears</a></li>
<li class="toctree-l1"><a class="reference internal" href="Database/index.html">Database Installation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="GettingStarted/BigPicture.html">The Big Picture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="TGScreencasts.html">TurboGears Screencasts</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Wiki20/Page1.html">The 20 Minutes Wiki</a></li>
<li class="toctree-l1"><a class="reference internal" href="GettingStarted/Controller.html">Controller Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="GettingStarted/Arguments.html">I Wanted An Argument!</a></li>
<li class="toctree-l1"><a class="reference internal" href="GettingStarted/UseDatabase.html">Data Model Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="GettingStarted/Kid.html">A Brief Introduction to Kid Templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="GettingStarted/MochiKit.html">A Brief Introduction to MochiKit</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Identity/GettingStarted.html">Getting Started With Identity</a></li>
<li class="toctree-l1"><a class="reference internal" href="Widgets/Introduction.html">Introduction To Widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="Widgets/SimpleForm.html">Simple Widget Form Tutorial</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">File Upload Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#update-the-database-tables">Update the Database Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-the-upload-method">Add the <tt class="docutils literal"><span class="pre">upload</span></tt> Method</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-an-upload-form-to-the-page-template">Add an Upload Form to the Page Template</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-file-listings-to-the-templates">Add File Listings to the Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-the-download-method">Add the <tt class="docutils literal"><span class="pre">download</span></tt> Method</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-error-handling-to-the-index-method">Add Error Handling to the <tt class="docutils literal"><span class="pre">index</span></tt> Method</a></li>
<li class="toctree-l2"><a class="reference internal" href="#refactor-the-templates">Refactor the Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="#attachments">Attachments</a></li>
<li class="toctree-l2"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ToDoListTutorial.html">Brian&#8217;s TurboGears Tutorial</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="TgAdmin.html">tg-admin command line tool reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="QuickStart.html">Are you ready to gear up?</a></li>
<li class="toctree-l1"><a class="reference internal" href="GettingStarted/Server.html">Starting Up The Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="Configuration.html">TurboGears Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="CreatingBigApplications.html">Creating Big Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="SpecificProblems.html">Solving specific problems</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="GettingStarted/Arguments.html">I Wanted An Argument!</a></li>
<li class="toctree-l1"><a class="reference internal" href="GettingStarted/URLs.html">Using URLs</a></li>
<li class="toctree-l1"><a class="reference internal" href="CreatingBigApplications.html">Creating Big Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="RequestResponse.html">Access Request/Response Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="StaticFiles.html">Serving Static Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cookies.html">Using Cookies in TurboGears</a></li>
<li class="toctree-l1"><a class="reference internal" href="Sessions.html">Using Sessions in TurboGears</a></li>
<li class="toctree-l1"><a class="reference internal" href="FeedController.html">Serving RSS and Atom feeds</a></li>
<li class="toctree-l1"><a class="reference internal" href="UnifiedControllers.html">Unified Form Data Validation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ExposeDecorator.html">&#64;expose()</a></li>
<li class="toctree-l1"><a class="reference internal" href="ValidateDecorator.html">&#64;validate()</a></li>
<li class="toctree-l1"><a class="reference internal" href="ErrorHandling.html">Error Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="Identity/Usage.html">Using Identity</a></li>
<li class="toctree-l1"><a class="reference internal" href="PaginateDecorator.html">&#64;paginate()</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="StdVars.html"><tt class="docutils literal"><span class="pre">stdvars</span></tt>: Global Template Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="HeadersFooters.html">Application-wide Headers and Footers</a></li>
<li class="toctree-l1"><a class="reference internal" href="JSON.html">JSON Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="Designer.html">Designer-Friendly Templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="DummyTemplate.html">Dummy Kid Template for Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="KidHTMLEntities.html">HTML Entities in Kid templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="CheckedCheckBox.html">Automatically Checking a Checkbox or Radio Button</a></li>
<li class="toctree-l1"><a class="reference internal" href="BreadCrumb.html">Breadcrumb Style Navigation</a></li>
<li class="toctree-l1"><a class="reference internal" href="CreatingBigApplications.html">Creating Big Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="NonPackagedKidTemplates.html">Loading Kid templates from outside your application package</a></li>
<li class="toctree-l1"><a class="reference internal" href="GenshiInternationalizationWithBabel.html">Genshi Templates Internationalization with Babel</a></li>
<li class="toctree-l1"><a class="reference internal" href="AdvancedCheetahTemplates.html">Templates for using TurboCheetah with TurboGears</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="GettingStarted/DefineDatabase.html">Data Model Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="BackEndOverview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="BackEndOverview.html#supported-backends">Supported backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="DbUri.html">The DB-URI</a></li>
<li class="toctree-l1"><a class="reference internal" href="SQLObject/index.html">SQLObject Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="TgAdminSqlUpgrade.html">How to Use <tt class="docutils literal"><span class="pre">tgadmin</span> <span class="pre">sql</span> <span class="pre">upgrade</span></tt> with SQLObject</a></li>
<li class="toctree-l1"><a class="reference internal" href="ModelOutsideTG.html">Using Your Model Outside of TurboGears Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="MultipleDatabases.html">Using Multiple Databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="SQLObject/AutoUpdateField.html">Auto-updating an attribute with SQLObject</a></li>
<li class="toctree-l1"><a class="reference internal" href="SQLObject/Debug.html">SQLObject Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="SQLObject/DirectSQL.html">SQLObject direct SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="SQLObject/ForeignKeys.html">SQLObject Foreign Keys</a></li>
<li class="toctree-l1"><a class="reference internal" href="SQLObject/QuickGuide.html">SQLObject Quick Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="SQLObject/ReservedWords.html">Avoiding SQL reserved words in the model definition</a></li>
<li class="toctree-l1"><a class="reference internal" href="SQLObject/Caching.html">SQLObject Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="SQLObject/Gotchas.html">SQLObject &#8220;gotcha&#8217;s&#8221;</a></li>
<li class="toctree-l1"><a class="reference internal" href="SQLObject/StoringAndRetrievingFiles.html">Storing and Retrieving Files from a Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="SQLObject/Views.html">Views in SQLObject</a></li>
<li class="toctree-l1"><a class="reference internal" href="SQLObject/VsHibernate.html">Hibernate vs SqlObject</a></li>
<li class="toctree-l1"><a class="reference internal" href="SQLAlchemy/Configuration.html">SQLAlchemy Configuration</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Widgets/Overview.html">Widgets Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="Widgets/index.html">Guide to the TurboGears Widgets Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Widgets/Browser.html">WidgetBrowser</a></li>
<li class="toctree-l1"><a class="reference internal" href="Widgets/Explore.html">Dive Into Widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="Widgets/SimpleForm.html">Simple Widget Form Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="Widgets/FormValidationWithSchemas.html">Widget Form Validation with Schemas</a></li>
<li class="toctree-l1"><a class="reference internal" href="Widgets/ModifyDefaults.html">Changing Widget Defaults at Run Time</a></li>
<li class="toctree-l1"><a class="reference internal" href="Widgets/DynamicForm.html">Dynamically Modifying a Form&#8217;s Widgets With Ajax</a></li>
<li class="toctree-l1"><a class="reference internal" href="DynamicValidation.html">Dynamic Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Widgets/Packages.html">Widget Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="Widgets/StatelessWidgets.html">StatelessWidgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="Widgets/DataGrid.html">DataGrid</a></li>
<li class="toctree-l1"><a class="reference internal" href="Widgets/AjaxGrid.html">Ajax Grid Widget</a></li>
<li class="toctree-l1"><a class="reference internal" href="Widgets/AutoCompleteField.html">The AutoCompleteField Widget</a></li>
<li class="toctree-l1"><a class="reference internal" href="Widgets/RemoteForm.html">RemoteForm Widget Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="Widgets/RemoteLink.html">Wrap Ajax Operations in Widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="Widgets/CompoundWidgets.html">Implementing and using CompoundWidgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="Widgets/RepeatingFieldSet.html">RepeatingFieldSet Tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="Widgets/CalendarDatePicker.html">CalendarDatePicker Widget</a></li>
<li class="toctree-l1"><a class="reference internal" href="Widgets/NicerForms.html">Nicer Forms</a></li>
<li class="toctree-l1"><a class="reference internal" href="FastData/index.html">FastData</a></li>
<li class="toctree-l1"><a class="reference internal" href="FastData/DataController.html">DataController</a></li>
<li class="toctree-l1"><a class="reference internal" href="Widgets/Recipes.html">Widget Recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="Widgets/Tips.html">Widget Tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="ToscaWidgets.html">Using ToscaWidgets in TurboGears 1.0</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Visit/index.html">Using the Visit Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="Visit/Extending.html">Extending the Visit Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="Visit/UserTrackedLogging.html">User Tracked Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="Visit/PermanentLogin.html">Permanent Login</a></li>
<li class="toctree-l1"><a class="reference internal" href="Identity/index.html">Identity Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="Identity/GettingStarted.html">Getting Started With Identity</a></li>
<li class="toctree-l1"><a class="reference internal" href="Identity/Usage.html">Using Identity</a></li>
<li class="toctree-l1"><a class="reference internal" href="Identity/EncryptedPassword.html">Using Identity with Encrypted Passwords</a></li>
<li class="toctree-l1"><a class="reference internal" href="Identity/Recipes.html">Identity Recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="Identity/OpenID.html">OpenID Authentication with TurboGears Identity</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Testing.html">Testing Your Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="LoggingSystem.html">Understanding the Logging System</a></li>
<li class="toctree-l1"><a class="reference internal" href="ErrorReporting.html">Custom Error Reporting</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Debugging.html">Debugging a TurboGears Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="DummyTemplate.html">Dummy Kid Template for Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="SQLObject/Debug.html">SQLObject Debugging</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Optimization.html">Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="CachingTechniques.html">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="GzipCompressing.html">Gzip Compressing Content</a></li>
<li class="toctree-l1"><a class="reference internal" href="UsingPylint.html">Using Pylint to Improve the Quality of Your Code</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Toolbox.html">TurboGears Toolbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="Admi18n.html">The Admi18n Tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="Catwalk.html">CatWalk</a></li>
<li class="toctree-l1"><a class="reference internal" href="FastData/DataController.html">DataController</a></li>
<li class="toctree-l1"><a class="reference internal" href="VersionInfo.html">Toolbox Info</a></li>
<li class="toctree-l1"><a class="reference internal" href="ModelDesigner.html">ModelDesigner</a></li>
<li class="toctree-l1"><a class="reference internal" href="WebConsole.html">Web Console</a></li>
<li class="toctree-l1"><a class="reference internal" href="Widgets/Browser.html">WidgetBrowser</a></li>
<li class="toctree-l1"><a class="reference internal" href="DreamWeaverIntegration.html">DreamWeaver Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="VimIntegration.html">Vim Editor Integration</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="FlashNotes.html">Using Flash Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="JsonifyDecorator.html">The <tt class="docutils literal"><span class="pre">jsonify</span></tt> Decorator</a></li>
<li class="toctree-l1"><a class="reference internal" href="Internationalization.html">Internationalizing your application</a></li>
<li class="toctree-l1"><a class="reference internal" href="UnicodeTips.html">Tips for Using Non-ASCII Characters in TurboGears</a></li>
<li class="toctree-l1"><a class="reference internal" href="Scheduler.html">Scheduling Tasks with TurboGears</a></li>
<li class="toctree-l1"><a class="reference internal" href="ErrorReporting.html">Custom Error Reporting</a></li>
<li class="toctree-l1"><a class="reference internal" href="ZeroConfSupport.html">Zeroconf support in TurboGears</a></li>
<li class="toctree-l1"><a class="reference internal" href="StartupHook.html">Startup Hook</a></li>
<li class="toctree-l1"><a class="reference internal" href="CRUDTemplate.html">CRUD Template</a></li>
<li class="toctree-l1"><a class="reference internal" href="RESTfulPath.html">RESTful URLs with TurboGears</a></li>
<li class="toctree-l1"><a class="reference internal" href="RESTfulPaginate.html">RESTful Pagination Using the Paginate Decorator</a></li>
<li class="toctree-l1"><a class="reference internal" href="WebServices.html">WebServices with TGWebServices</a></li>
<li class="toctree-l1"><a class="reference internal" href="OAuthAuthentication.html">Validating Signed Requests from OpenSocial Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="GenerateFigures.html">Generating Graphs and Figures in TurboGears</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">File Upload Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#update-the-database-tables">Update the Database Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-the-upload-method">Add the <tt class="docutils literal"><span class="pre">upload</span></tt> Method</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-an-upload-form-to-the-page-template">Add an Upload Form to the Page Template</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-file-listings-to-the-templates">Add File Listings to the Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-the-download-method">Add the <tt class="docutils literal"><span class="pre">download</span></tt> Method</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-error-handling-to-the-index-method">Add Error Handling to the <tt class="docutils literal"><span class="pre">index</span></tt> Method</a></li>
<li class="toctree-l2"><a class="reference internal" href="#refactor-the-templates">Refactor the Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="#attachments">Attachments</a></li>
<li class="toctree-l2"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="FileUploadProgressBar.html">File Upload Progress Bar</a></li>
<li class="toctree-l1"><a class="reference internal" href="AlternativeComponents.html">Alternative Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="GettingStarted/UseElixir.html">Getting Started with Elixir</a></li>
<li class="toctree-l1"><a class="reference internal" href="RoutesIntegration.html">Using Routes with TurboGears</a></li>
<li class="toctree-l1"><a class="reference internal" href="EntryPointList.html">TurboGears Entry Point list</a></li>
<li class="toctree-l1"><a class="reference internal" href="MakingYourAppExtensible.html">Making Extensible Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="TurboGearsAndMicroApps.html">What does this have to do with TurboGears?</a></li>
<li class="toctree-l1"><a class="reference internal" href="TurboGearsAndMicroApps.html#an-example-is-worth-a-thousand-pages-worth-of-blather">An example is worth a thousand pages worth of blather</a></li>
<li class="toctree-l1"><a class="reference internal" href="TurboGearsAndMicroApps.html#now-for-the-bad-news">Now for the bad news</a></li>
<li class="toctree-l1"><a class="reference internal" href="UsingSphinx.html">Using Sphinx</a></li>
<li class="toctree-l1"><a class="reference internal" href="CookieDefault.html">Cookie Default</a></li>
<li class="toctree-l1"><a class="reference internal" href="ConvertCookies.html">Converting Between Cookie Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="ExtraRequestParams.html">Handling Extra Request Parameters With CherryPy Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="RouteByHttpMethod.html">Routing Requests According to HTTP Request Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="VirtualHost.html">Virtual Host</a></li>
<li class="toctree-l1"><a class="reference internal" href="GenshiRenderingWithoutExpose.html">Genshi Rendering without using &#64;expose()</a></li>
<li class="toctree-l1"><a class="reference internal" href="ServeDynamicFiles.html">Serving Dynamically Generated Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="HybridNestedSetModel.html">Hybrid Nested Set Model for Hierarchical Storage of SQLObject Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="SockFile.html">Connecting to MySQL via a socket file</a></li>
<li class="toctree-l1"><a class="reference internal" href="SelectingOption.html">Setting the selected option of a SELECT element</a></li>
<li class="toctree-l1"><a class="reference internal" href="DojoIEWorkaround.html">Dojo / IE workaround</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Philosophy.html">TurboGears Project Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="Plugins.html">TurboGears Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="TemplatePlugins.html">Writing a Template Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="CommandPlugins.html"><tt class="docutils literal"><span class="pre">tg-admin</span></tt> Command Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="ExtendingQuickstart.html">Extending Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="License.html">TurboGears Licenses</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ThirdParty.html">ThirdParty Components Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="API.html">API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="ChangeLog.html">TurboGears Changelog</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="TGBooks.html">TurboGears Books</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="TGArticles.html">TuboGears Articles</a></li>
<li class="toctree-l1"><a class="reference internal" href="PresentationMaterial.html">TurboGears presentation material</a></li>
</ul>

        </div>
      </div>


    <div class="document">
  <div class="documentwrapper">
    <div class="body headerfix">
      
  <div class="section" id="file-upload-tutorial">
<span id="index-0"></span><h1><a class="toc-backref" href="#id1">File Upload Tutorial</a><a class="headerlink" href="#file-upload-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Check the bottom of the page for the example project.</p>
</div>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#file-upload-tutorial" id="id1">File Upload Tutorial</a><ul>
<li><a class="reference internal" href="#update-the-database-tables" id="id2">Update the Database Tables</a></li>
<li><a class="reference internal" href="#add-the-upload-method" id="id3">Add the <tt class="docutils literal"><span class="pre">upload</span></tt> Method</a></li>
<li><a class="reference internal" href="#add-an-upload-form-to-the-page-template" id="id4">Add an Upload Form to the Page Template</a></li>
<li><a class="reference internal" href="#add-file-listings-to-the-templates" id="id5">Add File Listings to the Templates</a></li>
<li><a class="reference internal" href="#add-the-download-method" id="id6">Add the <tt class="docutils literal"><span class="pre">download</span></tt> Method</a></li>
<li><a class="reference internal" href="#add-error-handling-to-the-index-method" id="id7">Add Error Handling to the <tt class="docutils literal"><span class="pre">index</span></tt> Method</a></li>
<li><a class="reference internal" href="#refactor-the-templates" id="id8">Refactor the Templates</a></li>
<li><a class="reference internal" href="#attachments" id="id9">Attachments</a></li>
<li><a class="reference internal" href="#references" id="id10">References</a></li>
</ul>
</li>
</ul>
</div>
<p>This is a follow up to the existing <a class="reference internal" href="Wiki20/Page1.html"><em>20 minute wiki tutorial</em></a>. At this
point, it is assumed that you have:</p>
<ul class="simple">
<li>installed TG</li>
<li>completed the previous tutorial</li>
<li>are ready to add to that tutorial.</li>
</ul>
<p>Here is what this tutorial is all about: file uploads. After completing the
above tutorial, I thought, &#8216;gee, it&#8217;d be cool if I could upload files to
the wiki&#8217;. And the way things go, one thing leads to another, and I wanted
to download them, too. This introduces some issues, like:</p>
<ul class="simple">
<li>the user interface for displaying the files (we&#8217;ll use templates for all
the common stuff)</li>
<li>the user interface for uploading/downloading the files</li>
<li>state issues: we don&#8217;t want to upload a file to a page that doesn&#8217;t
exist yet.</li>
</ul>
<p>Rather than take you step-wise through my thought process and build this app
like a real tutorial, I&#8217;ll present the major issues along with the major
chunks of code to address them.</p>
<p>BTW, you don&#8217;t have to copy and paste from this page, there is a ZIP file
with the example project attached to this page. Skip down to the bottom of
this page to find the download link.</p>
<p>Note that in another article we also show how you can <a class="reference internal" href="FileUploadProgressBar.html"><em>display a progress bar
during file uploads</em></a>.</p>
<div class="section" id="update-the-database-tables">
<h2><a class="toc-backref" href="#id2">Update the Database Tables</a><a class="headerlink" href="#update-the-database-tables" title="Permalink to this headline">¶</a></h2>
<p>We need to update the database to add a new table, the <tt class="docutils literal"><span class="pre">uploaded_files</span></tt>
table. This is a many-to-many relationship in my example. We&#8217;ll have to
drop our old tables and re-create these for the relationships to match.
Here we go:</p>
<ol class="arabic">
<li><p class="first">Stop the server</p>
</li>
<li><p class="first">Drop the existing tables:</p>
<div class="highlight-python"><pre>tg-admin sql drop page
tg-admin sql drop uploadedfile</pre>
</div>
</li>
<li><p class="first">Edit your <tt class="docutils literal"><span class="pre">model.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">sqlobject</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">turbogears.database</span> <span class="kn">import</span> <span class="n">PackageHub</span>

<span class="n">hub</span> <span class="o">=</span> <span class="n">PackageHub</span><span class="p">(</span><span class="s">&quot;wiki20&quot;</span><span class="p">)</span>
<span class="n">__connection__</span> <span class="o">=</span> <span class="n">hub</span>

<span class="c"># class YourDataClass(SQLObject):</span>
<span class="c">#     pass</span>

<span class="k">class</span> <span class="nc">Page</span><span class="p">(</span><span class="n">SQLObject</span><span class="p">):</span>
    <span class="n">pagename</span> <span class="o">=</span> <span class="n">UnicodeCol</span><span class="p">(</span><span class="n">alternateID</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">UnicodeCol</span><span class="p">()</span>
    <span class="n">attached_files</span> <span class="o">=</span> <span class="n">RelatedJoin</span><span class="p">(</span><span class="s">&#39;UploadedFile&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">UploadedFile</span><span class="p">(</span><span class="n">SQLObject</span><span class="p">):</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">UnicodeCol</span><span class="p">(</span><span class="n">alternateID</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">abspath</span> <span class="o">=</span> <span class="n">UnicodeCol</span><span class="p">()</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">IntCol</span><span class="p">()</span>
    <span class="n">referenced_in_pages</span> <span class="o">=</span> <span class="n">RelatedJoin</span><span class="p">(</span><span class="s">&#39;Page&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Create the new tables:</p>
<div class="highlight-python"><pre>tg-admin sql create</pre>
</div>
</li>
</ol>
</div>
<div class="section" id="add-the-upload-method">
<h2><a class="toc-backref" href="#id3">Add the <tt class="docutils literal"><span class="pre">upload</span></tt> Method</a><a class="headerlink" href="#add-the-upload-method" title="Permalink to this headline">¶</a></h2>
<p>Here is the meat and potatoes. We add the <tt class="docutils literal"><span class="pre">upload</span></tt> method and a bunch of
state logic to the controller. The idea is simple: we want to upload files
and have them relate to a page. If a user uploads a previously uploaded
file, we skip the upload, but we add the relationship to the db. So,
multiple pages can reference a single uploaded file. And a single page can
reference many files. Let&#8217;s store these files in an app configured location:</p>
<ol class="arabic">
<li><p class="first">Add a new config setting for the path of the upload directory to the
config file:</p>
<div class="highlight-python"><pre># def.cfg
[global]

# Upload dir
wiki.uploads="./uploads"</pre>
</div>
</li>
<li><p class="first">Add code to the controller to check for the existence of the upload
directory, create it if necessary:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># controller.py</span>

<span class="c"># default upload dir to ./uploads</span>
<span class="n">UPLOAD_DIR</span> <span class="o">=</span> <span class="n">cherrypy</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;wiki.uploads&quot;</span><span class="p">,</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s">&quot;uploads&quot;</span><span class="p">))</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">UPLOAD_DIR</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">UPLOAD_DIR</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Add the <tt class="docutils literal"><span class="pre">upload</span></tt> method (remember meat and potatoes):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># controller.py</span>

<span class="nd">@turbogears.expose</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">upload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">upload_file</span><span class="p">,</span> <span class="n">pagename</span><span class="p">,</span> <span class="o">**</span><span class="n">keywords</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">byPagename</span><span class="p">(</span><span class="n">pagename</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">SQLObjectNotFound</span><span class="p">:</span>
        <span class="n">turbogears</span><span class="o">.</span><span class="n">flash</span><span class="p">(</span><span class="s">&quot;Must save page first&quot;</span><span class="p">)</span>
        <span class="n">turbogears</span><span class="o">.</span><span class="n">redirect</span><span class="p">(</span><span class="s">&quot;/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">pagename</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">upload_file</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">target_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">UPLOAD_DIR</span><span class="p">,</span>
      <span class="n">upload_file</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span>  <span class="n">UploadedFile</span><span class="o">.</span><span class="n">byFilename</span><span class="p">(</span><span class="n">upload_file</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">turbogears</span><span class="o">.</span><span class="n">flash</span><span class="p">(</span>
          <span class="s">&quot;File already uploaded: </span><span class="si">%s</span><span class="s"> is already at </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
          <span class="p">(</span><span class="n">upload_file</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">target_file_name</span><span class="p">))</span>
    <span class="k">except</span> <span class="n">SQLObjectNotFound</span><span class="p">:</span>
        <span class="c"># open file in binary mode for writing</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">target_file_name</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">turbogears</span><span class="o">.</span><span class="n">flash</span><span class="p">(</span>
          <span class="s">&quot;File uploaded successfully: </span><span class="si">%s</span><span class="s"> saved as: </span><span class="si">%s</span><span class="s">&quot;</span> \
          <span class="o">%</span> <span class="p">(</span><span class="n">upload_file</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">target_file_name</span><span class="p">))</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">UploadedFile</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">upload_file</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
          <span class="n">abspath</span><span class="o">=</span><span class="n">target_file_name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">Page</span><span class="o">.</span><span class="n">byPagename</span><span class="p">(</span><span class="n">pagename</span><span class="p">)</span><span class="o">.</span><span class="n">addUploadedFile</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="n">turbogears</span><span class="o">.</span><span class="n">redirect</span><span class="p">(</span><span class="s">&quot;/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">pagename</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Note: the above code looks in the database to determine if the page
to which the file is uploaded already exists. If the page doesn&#8217;t
exist in the database yet, then we cannot attach an uploaded file
to it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">try</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">byPagename</span><span class="p">(</span><span class="n">pagename</span><span class="p">)</span>
<span class="k">except</span> <span class="n">SQLObjectNotFound</span><span class="p">:</span>
    <span class="n">turbogears</span><span class="o">.</span><span class="n">flash</span><span class="p">(</span><span class="s">&quot;Must save page first&quot;</span><span class="p">)</span>
    <span class="n">turbogears</span><span class="o">.</span><span class="n">redirect</span><span class="p">(</span><span class="s">&quot;/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">pagename</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="add-an-upload-form-to-the-page-template">
<h2><a class="toc-backref" href="#id4">Add an Upload Form to the Page Template</a><a class="headerlink" href="#add-an-upload-form-to-the-page-template" title="Permalink to this headline">¶</a></h2>
<p>Here is the form that calls the upload method in the <tt class="docutils literal"><span class="pre">page.kid</span></tt>
template:</p>
<div class="highlight-python"><pre>&lt;!-- page.kid --&gt;

&lt;form action="upload" method="POST" enctype="multipart/form-data"&gt;
    &lt;input type="hidden" name="pagename" py:attrs="value=pagename"/&gt;
    &lt;label for="upload_file"&gt;Filename:&lt;/label&gt;
    &lt;input type="file" name="upload_file" id="upload_file"/&gt;  &lt;br/&gt;
    &lt;input type="submit" name="submit_upload" value="Upload"/&gt;
&lt;/form&gt;</pre>
</div>
<p>Note that we have an <tt class="docutils literal"><span class="pre">INPUT</span></tt> element named <tt class="docutils literal"><span class="pre">&quot;upload&quot;</span></tt> of type <tt class="docutils literal"><span class="pre">file</span></tt>.
The other important aspects are that we use the <tt class="docutils literal"><span class="pre">POST</span></tt> method to submit
the form and that we also added the <tt class="docutils literal"><span class="pre">enctype=&quot;multipart/form-data&quot;</span></tt>
attribute to the <tt class="docutils literal"><span class="pre">FORM</span></tt> element. Without the latter, the file would be
received by the controller as a normal string and would almost certainly
become corrupted due to the input encoding conversion and our controller
code would not work.</p>
</div>
<div class="section" id="add-file-listings-to-the-templates">
<h2><a class="toc-backref" href="#id5">Add File Listings to the Templates</a><a class="headerlink" href="#add-file-listings-to-the-templates" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Template code:</p>
<div class="highlight-python"><pre>&lt;h3&gt;Attached Files:&lt;/h3&gt;
&lt;ul&gt;
    &lt;li py:for="filename in uploads"&gt;
        &lt;a href="/download?filename=${filename}" py:content="filename"
          &gt;Filename  goes here&lt;/a&gt;
    &lt;/li&gt;
&lt;/ul&gt;</pre>
</div>
</li>
<li><p class="first">Add this code to <tt class="docutils literal"><span class="pre">page.kid</span></tt> and <tt class="docutils literal"><span class="pre">edit.kid</span></tt> somewhere at the bottom.</p>
</li>
<li><p class="first">I&#8217;ve appended to this tutorial my notes for generalizing this with
templates (see below).</p>
</li>
</ol>
</div>
<div class="section" id="add-the-download-method">
<h2><a class="toc-backref" href="#id6">Add the <tt class="docutils literal"><span class="pre">download</span></tt> Method</a><a class="headerlink" href="#add-the-download-method" title="Permalink to this headline">¶</a></h2>
<p>CherryPy provides the function <tt class="docutils literal"><span class="pre">cherrypy.lib.cptools.serve_file</span></tt>, which
makes serving files super simple:</p>
<div class="highlight-python"><pre># controller.py

@turbogears.expose()
def download(self, filename):
    uf = UploadedFile.byFilename(filename)
    return cherrypy.lib.cptools.serve_file(uf.abspath,
      contentType"application/x-download", dispositon="attachment",
      uf.filename)</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">disposition=&quot;attachment&quot;</span></tt> argument, will cause a <tt class="docutils literal"><span class="pre">Content-disposition</span></tt>
header to be sent to the browser which makes it pop up a download saving dialog.</p>
<p>If you want the browser to start the application or plug-in configured to handle
files of the downloaded type, use a <tt class="docutils literal"><span class="pre">disposition=&quot;inline&quot;</span></tt> argument
and set the <tt class="docutils literal"><span class="pre">contentType</span></tt> parameter to the mime type of the file you are
serving. To find out the mime-type of a file you can use the <a class="reference external" href="http://docs.python.org/lib/module-mimetypes.html">mimetypes</a> module
from the standard library.</p>
<p>Note that it&#8217;s good practice to specify the filename in the
<tt class="docutils literal"><span class="pre">Content-disposition</span></tt> header. Otherwise the user will see the last part
of the URL as filename. If you ever downloaded a file from a web-page and
the browser suggested <tt class="docutils literal"><span class="pre">&quot;download.php&quot;</span></tt> or something similar as the
filename, you&#8217;ll know what I mean ;). Luckily, the CherryPy <tt class="docutils literal"><span class="pre">serve_file</span></tt>
function already takes care of this for us.</p>
</div>
<div class="section" id="add-error-handling-to-the-index-method">
<h2><a class="toc-backref" href="#id7">Add Error Handling to the <tt class="docutils literal"><span class="pre">index</span></tt> Method</a><a class="headerlink" href="#add-error-handling-to-the-index-method" title="Permalink to this headline">¶</a></h2>
<p>In case the <tt class="docutils literal"><span class="pre">publish</span> <span class="pre">parts</span></tt> call throws an error, we will catch this
with a <tt class="docutils literal"><span class="pre">try/except</span></tt> clause and just display the ReST source directly:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># controller.py</span>

<span class="nd">@turbogears.expose</span><span class="p">(</span><span class="s">&quot;toddswiki.templates.page&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="s">&quot;FrontPage&quot;</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">byPagename</span><span class="p">(</span><span class="n">pagename</span><span class="p">)</span>
        <span class="n">uploads</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">filename</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">attached_files</span><span class="p">]</span>
    <span class="k">except</span> <span class="n">SQLObjectNotFound</span><span class="p">:</span>
        <span class="n">turbogears</span><span class="o">.</span><span class="n">redirect</span><span class="p">(</span><span class="s">&quot;/notfound&quot;</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="n">pagename</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">publish_parts</span><span class="p">(</span>
          <span class="n">page</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">writer_name</span><span class="o">=</span><span class="s">&quot;html&quot;</span><span class="p">)[</span><span class="s">&quot;html_body&quot;</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">data</span>
    <span class="n">root</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">turbogears</span><span class="o">.</span><span class="n">url</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">))</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">wikiwords</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r&#39; &lt;a href=&quot;</span><span class="si">%s</span><span class="s">\1&quot;&gt;\1&lt;/a&gt; &#39;</span> <span class="o">%</span> <span class="n">root</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">pagename</span><span class="o">=</span><span class="n">page</span><span class="o">.</span><span class="n">pagename</span><span class="p">,</span> <span class="n">uploads</span><span class="o">=</span><span class="n">uploads</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="refactor-the-templates">
<h2><a class="toc-backref" href="#id8">Refactor the Templates</a><a class="headerlink" href="#refactor-the-templates" title="Permalink to this headline">¶</a></h2>
<p>We&#8217;ll use template inheritance feature of Kid to simplify the file
listing in the templates. Make the following changes to get this working:</p>
<div class="highlight-python"><pre>&lt;!-- master.kid --&gt;

&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;
&lt;?python import sitetemplate ?&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml"
  xmlns:py="http://purl.org/kid/ns#"
  py:extends="sitetemplate, 'includes.kid'"&gt;</pre>
</div>
<div class="highlight-python"><pre>&lt;!-- page.kid / edit.kid --&gt;

&lt;div py:replace="attached_files(${uploads})"/&gt;</pre>
</div>
<div class="highlight-python"><pre>&lt;!-- includes.kid --&gt;

&lt;h3&gt;Attached Files:&lt;/h3&gt;
&lt;ul py:def="attached_files(uploads)"&gt;
    &lt;li py:for="filename in uploads"&gt;
        &lt;a href="./download?filename=${filename}"
          py:content="filename"&gt;Filename goes here&lt;/a&gt;
    &lt;/li&gt;
&lt;/ul&gt;</pre>
</div>
<p>For more details, see:</p>
<ul class="simple">
<li><a class="reference external" href="http://kid.lesscode.org/language.html#template-reuse-py-extends">http://kid.lesscode.org/language.html#template-reuse-py-extends</a></li>
<li><a class="reference external" href="http://lesscode.org/projects/kid/wiki/IncludeSectionFromOtherTemplateRecipe">http://lesscode.org/projects/kid/wiki/IncludeSectionFromOtherTemplateRecipe</a></li>
</ul>
</div>
<div class="section" id="attachments">
<h2><a class="toc-backref" href="#id9">Attachments</a><a class="headerlink" href="#attachments" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference download internal" href="_downloads/wiki.zip"><tt class="xref download docutils literal"><span class="pre">wiki.zip</span></tt></a> (30.4 kB) -full files for the
FileUploadTutorial added by GreenTea &lt;<a class="reference external" href="mailto:tgreenwoodgeer&#37;&#52;&#48;yahoo&#46;com">tgreenwoodgeer<span>&#64;</span>yahoo<span>&#46;</span>com</a>&gt; on
10/20/05 18:14:28.</li>
</ul>
</div>
<div class="section" id="references">
<h2><a class="toc-backref" href="#id10">References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>More information, documentation and tutorials on CherryPy file uploads
can be found at the following locations:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.alleged.org.uk/pdc/2006/03/08.html">TurboGears and Uploading Pictures</a>
on Damian Cugley’s blog.</li>
<li>The file <a class="reference external" href="http://cherrypy.org/browser/branches/cherrypy-2.x/cherrypy/tutorial/tut09_files.py">cherrypy/tutorial/tut09_files.py</a>
in the CherryPy distribution.</li>
</ul>
</div>
</div>


    </div>
  </div>
      <div class="clearer"></div>
    </div>
  <div class="footer"><span>
      &copy; Copyright 
      by the <a href="">TurboGears</a> Doc Team.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
  </span></div>
  <script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
  </script>
  <script type="text/javascript">
  try {
  var pageTracker = _gat._getTracker("UA-7088080-2");
  pageTracker._trackPageview();
  } catch(err) {}</script>
  </body>
</html>